{
  "hash": "c76582096f4fdb7d9a8a8b2c1c2b3c73",
  "result": {
    "engine": "knitr",
    "markdown": "# Longitudinal Multilevel Models\n\n\n::: {.cell}\n\n:::\n\n\n## The Data\n\nThe data employed in these examples are a longitudinal extension of the data described in @sec-data.\n\n## The Equation\n\n$$\\text{outcome}_{itj} = \\beta_0 + \\beta_1 \\text{parental warmth}_{itj} + \\beta_2 \\text{physical punishment}_{itj} + \\beta_3 \\text{time}_{itj} \\ + $$ {#eq-MLM-longitudinal} \n\n$$\\beta_4 \\text{identity}_{itj} + \\beta_5 \\text{intervention}_{itj} + \\beta_6 \\text{HDI}_{j} +$$\n\n$$u_{0j} + u_{1j} \\times \\text{parental warmth}_{itj} \\ + $$\n\n$$v_{0ij} + v_{1ij} \\times \\text{time}_{itj} + e_{itj}$$\n\n## Growth Trajectories\n\nRemember, following Section 6.4, that in longitudinal multilevel models, the variable for *time* assumes an important role as we are often thinking of a *growth trajectory* over time.\n\nAs discussed in Section 6.4, think about a model where *identity* is a (1/0) variable for membership in one of two groups:\n\n$$\\text{outcome} = \\beta_0 + \\beta_t \\text{time} + \\beta_\\text{identity} \\text{identity} + \\beta_\\text{interaction} \\text{identity} \\times \\text{time} + u_{0i} + e_{it}$$\n\nThen, each identity group has its own intercept and time trajectory:\n\n| Group | Intercept                         |  Slope (Time Trajectory)             |\n|-------|-----------------------------------|--------------------------------------|\n| 0     | $\\beta_0$                         | $\\beta_t$                            |\n| 1     | $\\beta_0 + \\beta_\\text{identity}$ | $\\beta_t + \\beta_\\text{interaction}$ |\n\n: Slope and Intercept for Each Group {#tbl-trajectory}\n\n\n::: {.callout-tip}\n## Main Effects and Interactions\n\nThus, again following Section 6.4, in longitudinal multilevel models, *main effects* modify the *intercept* of the time trajectory, while *interactions with time*, modify the *slope* of the time trajectory. Below, we run models with *main effects only*, then models with *main effects, and interactions with time*.\n:::\n\n## Run Models\n\n::: {.panel-tabset group=\"language\"}\n\n### Stata\n\n#### Get The Data \n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nuse simulated_multilevel_longitudinal_data.dta\n\n```\n:::\n\n\n#### Run The Model\n\n##### Main Effects Only\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nmixed outcome t warmth physical_punishment i.identity i.intervention HDI || country: warmth || family: t\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood =  -28523.49  \nIteration 1:  Log likelihood = -28499.987  \nIteration 2:  Log likelihood = -28499.737  \nIteration 3:  Log likelihood = -28499.604  \nIteration 4:  Log likelihood = -28499.603  \n\nComputing standard errors ...\n\nMixed-effects ML regression                            Number of obs =   9,000\n\n        Grouping information\n        -------------------------------------------------------------\n                        |     No. of       Observations per group\n         Group variable |     groups    Minimum    Average    Maximum\n        ----------------+--------------------------------------------\n                country |         30        300      300.0        300\n                 family |      3,000          3        3.0          3\n        -------------------------------------------------------------\n\n                                                       Wald chi2(6)  = 1096.15\nLog likelihood = -28499.603                            Prob > chi2   =  0.0000\n\n-------------------------------------------------------------------------------------\n            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n--------------------+----------------------------------------------------------------\n                  t |    .943864   .0658716    14.33   0.000      .814758     1.07297\n             warmth |    .913496   .0423731    21.56   0.000     .8304462    .9965457\nphysical_punishment |  -1.007897   .0497622   -20.25   0.000    -1.105429   -.9103647\n         1.identity |  -.1276926   .1515835    -0.84   0.400    -.4247909    .1694056\n     1.intervention |   .8589966   .1519095     5.65   0.000     .5612596    1.156734\n                HDI |  -.0005657   .0196437    -0.03   0.977    -.0390666    .0379352\n              _cons |   50.46724   1.338318    37.71   0.000     47.84418    53.09029\n-------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Independent         |\n                 var(warmth) |   .0107584   .0127845      .0010477    .1104715\n                  var(_cons) |   3.167089   .9146768      1.798157    5.578187\n-----------------------------+------------------------------------------------\nfamily: Independent          |\n                      var(t) |   3.74e-09   7.36e-07      1.4e-176    9.7e+158\n                  var(_cons) |   8.387276    .472419      7.510631    9.366243\n-----------------------------+------------------------------------------------\n               var(Residual) |   26.02733   .4753702      25.11211    26.97592\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(4) = 1247.03               Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n##### Interactions With Time\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nmixed outcome c.t##(c.warmth c.physical_punishment i.identity i.intervention c.HDI) || country: warmth || family: t\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood =  -28522.21  \nIteration 1:  Log likelihood = -28498.685  \nIteration 2:  Log likelihood = -28498.469  \nIteration 3:  Log likelihood =  -28498.31  \nIteration 4:  Log likelihood = -28498.309  \n\nComputing standard errors ...\n\nMixed-effects ML regression                            Number of obs =   9,000\n\n        Grouping information\n        -------------------------------------------------------------\n                        |     No. of       Observations per group\n         Group variable |     groups    Minimum    Average    Maximum\n        ----------------+--------------------------------------------\n                country |         30        300      300.0        300\n                 family |      3,000          3        3.0          3\n        -------------------------------------------------------------\n\n                                                       Wald chi2(11) = 1100.25\nLog likelihood = -28498.309                            Prob > chi2   =  0.0000\n\n---------------------------------------------------------------------------------------\n              outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n----------------------+----------------------------------------------------------------\n                    t |   .7582075    .326177     2.32   0.020     .1189122    1.397503\n               warmth |   .8170757    .082662     9.88   0.000     .6550611    .9790903\n  physical_punishment |  -1.009031   .1112932    -9.07   0.000    -1.227162   -.7909007\n           1.identity |  -.2387167   .3039964    -0.79   0.432    -.8345387    .3571053\n       1.intervention |   .6607606   .3044503     2.17   0.030      .064049    1.257472\n                  HDI |   .0013614   .0210842     0.06   0.949    -.0399628    .0426856\n                      |\n         c.t#c.warmth |   .0483637   .0356074     1.36   0.174    -.0214255    .1181529\n                      |\n                  c.t#|\nc.physical_punishment |   .0005421   .0494355     0.01   0.991    -.0963496    .0974338\n                      |\n         identity#c.t |\n                   1  |   .0554389   .1317444     0.42   0.674    -.2027754    .3136532\n                      |\n     intervention#c.t |\n                   1  |   .0992811    .131925     0.75   0.452    -.1592872    .3578493\n                      |\n            c.t#c.HDI |  -.0009551   .0038216    -0.25   0.803    -.0084453    .0065352\n                      |\n                _cons |   50.83632   1.483548    34.27   0.000     47.92862    53.74402\n---------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Independent         |\n                 var(warmth) |   .0106014   .0127458      .0010046    .1118779\n                  var(_cons) |   3.170089   .9153354      1.800091    5.582753\n-----------------------------+------------------------------------------------\nfamily: Independent          |\n                      var(t) |   1.36e-09   2.89e-07      1.7e-190    1.1e+172\n                  var(_cons) |   8.391888   .4724105      7.515232    9.370806\n-----------------------------+------------------------------------------------\n               var(Residual) |   26.01583   .4751604      25.10101      26.964\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(4) = 1247.84               Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n### R\n\n#### Get The Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\n\ndfL <- read_dta(\"simulated_multilevel_longitudinal_data.dta\")\n```\n:::\n\n\n#### Run The Model\n\n::: {.callout-caution collapse=\"false\"}\n`lme4` does not directly provide p values in results, because of some disagreement over exactly how these p values should be calculated. Therefore, in this Appendix, I also call library `lmerTest` to provide p values for `lme4` results.\n:::\n\n::: {.callout-tip}\nR prefers to use scientific notation when possible. I find that the use of scientific notation can be confusing in reading results. I turn off scientific notation by setting a penalty for its use:  `options(scipen = 999)`.  \n:::\n\n##### Main Effects Only\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4) \n\nlibrary(lmerTest)\n\noptions(scipen = 999) \n\nfit2A <- lmer(outcome ~ t + warmth + physical_punishment + \n               identity + intervention + HDI +\n               (1 | country/id),\n             data = dfL)\n\nsummary(fit2A)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: \noutcome ~ t + warmth + physical_punishment + identity + intervention +  \n    HDI + (1 | country/id)\n   Data: dfL\n\nREML criterion at convergence: 57022.7\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.6850 -0.6094 -0.0035  0.6133  3.6792 \n\nRandom effects:\n Groups     Name        Variance Std.Dev.\n id:country (Intercept)  8.438   2.905   \n country    (Intercept)  3.675   1.917   \n Residual               26.036   5.103   \nNumber of obs: 9000, groups:  id:country, 3000; country, 30\n\nFixed effects:\n                        Estimate   Std. Error           df t value\n(Intercept)           50.3842343    1.4139114   29.8246912  35.635\nt                      0.9433806    0.0658755 5998.3764548  14.321\nwarmth                 0.9140307    0.0379336 4745.3497493  24.096\nphysical_punishment   -1.0087537    0.0497972 6483.6771808 -20.257\nidentity              -0.1319548    0.1517350 2968.7828107  -0.870\nintervention           0.8591494    0.1520510 2971.8111995   5.650\nHDI                    0.0007909    0.0207656   28.0001855   0.038\n                                Pr(>|t|)    \n(Intercept)         < 0.0000000000000002 ***\nt                   < 0.0000000000000002 ***\nwarmth              < 0.0000000000000002 ***\nphysical_punishment < 0.0000000000000002 ***\nidentity                           0.385    \nintervention                0.0000000175 ***\nHDI                                0.970    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) t      warmth physc_ idntty intrvn\nt           -0.092                                   \nwarmth      -0.091 -0.002                            \nphyscl_pnsh -0.092 -0.007 -0.012                     \nidentity    -0.051  0.000 -0.013 -0.003              \ninterventin -0.058  0.000  0.039  0.019 -0.018       \nHDI         -0.951  0.000 -0.004  0.005  0.000  0.002\n```\n\n\n:::\n:::\n\n\n##### Interactions With Time\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2B <- lmer(outcome ~ t *(warmth + physical_punishment + \n               identity + intervention + HDI) +\n               (1 | country/id),\n             data = dfL)\n\nsummary(fit2B)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: \noutcome ~ t * (warmth + physical_punishment + identity + intervention +  \n    HDI) + (1 | country/id)\n   Data: dfL\n\nREML criterion at convergence: 57042.8\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.7118 -0.6092 -0.0024  0.6150  3.6779 \n\nRandom effects:\n Groups     Name        Variance Std.Dev.\n id:country (Intercept)  8.436   2.905   \n country    (Intercept)  3.675   1.917   \n Residual               26.046   5.104   \nNumber of obs: 9000, groups:  id:country, 3000; country, 30\n\nFixed effects:\n                          Estimate   Std. Error           df t value\n(Intercept)             50.7590272    1.5518360   43.2608620  32.709\nt                        0.7552909    0.3263028 6176.7440549   2.315\nwarmth                   0.8170912    0.0805355 8274.9995422  10.146\nphysical_punishment     -1.0097729    0.1113557 8084.6084915  -9.068\nidentity                -0.2446453    0.3041604 8695.8966197  -0.804\nintervention             0.6604671    0.3046286 8697.0843430   2.168\nHDI                      0.0026692    0.0221295   36.1037733   0.121\nt:warmth                 0.0486211    0.0356217 6404.8723333   1.365\nt:physical_punishment    0.0004964    0.0494590 6753.0158441   0.010\nt:identity               0.0563140    0.1318043 5993.4518022   0.427\nt:intervention           0.0995037    0.1319917 5994.1433001   0.754\nt:HDI                   -0.0009379    0.0038233 5993.9090880  -0.245\n                                 Pr(>|t|)    \n(Intercept)           <0.0000000000000002 ***\nt                                  0.0207 *  \nwarmth                <0.0000000000000002 ***\nphysical_punishment   <0.0000000000000002 ***\nidentity                           0.4212    \nintervention                       0.0302 *  \nHDI                                0.9047    \nt:warmth                           0.1723    \nt:physical_punishment              0.9920    \nt:identity                         0.6692    \nt:intervention                     0.4510    \nt:HDI                              0.8062    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) t      warmth physc_ idntty intrvn HDI    t:wrmt t:phy_\nt           -0.421                                                        \nwarmth      -0.178  0.331                                                 \nphyscl_pnsh -0.190  0.360 -0.005                                          \nidentity    -0.093  0.166 -0.013 -0.002                                   \ninterventin -0.107  0.192  0.039  0.019 -0.017                            \nHDI         -0.925  0.264 -0.007  0.012 -0.001  0.003                     \nt:warmth     0.158 -0.377 -0.882  0.001  0.011 -0.035  0.006              \nt:physcl_pn  0.170 -0.402  0.004 -0.894 -0.001 -0.017 -0.010 -0.003       \nt:identity   0.081 -0.192  0.011  0.000 -0.867  0.014  0.001 -0.013  0.002\nt:intervntn  0.093 -0.222 -0.035 -0.017  0.014 -0.867 -0.003  0.041  0.019\nt:HDI        0.322 -0.765  0.015 -0.027  0.002 -0.007 -0.346 -0.016  0.029\n            t:dntt t:ntrv\nt                        \nwarmth                   \nphyscl_pnsh              \nidentity                 \ninterventin              \nHDI                      \nt:warmth                 \nt:physcl_pn              \nt:identity               \nt:intervntn -0.016       \nt:HDI       -0.002  0.008\n```\n\n\n:::\n:::\n\n\n\n### Julia\n\n#### Get The Data\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nusing Tables, MixedModels, StatFiles, DataFrames, CategoricalArrays, DataFramesMeta\n\ndfL = DataFrame(load(\"simulated_multilevel_longitudinal_data.dta\"))\n```\n:::\n\n\n#### Run The Model\n\n##### Change Country To Categorical\n\n\n::: {.cell}\n\n```{.julia .cell-code}\n@transform!(dfL, :country = categorical(:country))\n```\n:::\n\n\n##### Main Effects Only\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nm2A = fit(MixedModel, @formula(outcome ~ t + warmth + \n                                 physical_punishment + \n                                 identity + intervention + \n                                 HDI +\n                                 (1 | country) + \n                                 (0 + warmth | country) +\n                                 (1 | id)), dfL)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood\n outcome ~ 1 + t + warmth + physical_punishment + identity + intervention + HDI + (1 | country) + (0 + warmth | country) + (1 | id)\n    logLik   -2 logLik      AIC         AICc        BIC     \n -28499.6031  56999.2063  57021.2063  57021.2356  57099.3610\n\nVariance components:\n            Column    Variance Std.Dev.   Corr.\nid       (Intercept)   8.387214 2.896069\ncountry  (Intercept)   3.167143 1.779647\n         warmth        0.010762 0.103739   .  \nResidual              26.027363 5.101702\n Number of obs: 9000; levels of grouping factors: 3000, 30\n\n  Fixed-effects parameters:\n───────────────────────────────────────────────────────────────\n                            Coef.  Std. Error       z  Pr(>|z|)\n───────────────────────────────────────────────────────────────\n(Intercept)          50.4673        1.33833     37.71    <1e-99\nt                     0.943864      0.0658717   14.33    <1e-45\nwarmth                0.913496      0.0423744   21.56    <1e-99\nphysical_punishment  -1.0079        0.0497622  -20.25    <1e-90\nidentity             -0.127692      0.151583    -0.84    0.3996\nintervention          0.858997      0.151909     5.65    <1e-07\nHDI                  -0.000566026   0.0196439   -0.03    0.9770\n───────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n##### Interactions With Time\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nm2B = fit(MixedModel, @formula(outcome ~ t * (warmth + \n                                 physical_punishment + \n                                 identity + intervention + \n                                   HDI) +\n                                 (1 | country) +\n                                 (0 + warmth | country) +\n                                 (1 | id)), dfL)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood\n outcome ~ 1 + t + warmth + physical_punishment + identity + intervention + HDI + t & warmth + t & physical_punishment + t & identity + t & intervention + t & HDI + (1 | country) + (0 + warmth | country) + (1 | id)\n    logLik   -2 logLik      AIC         AICc        BIC     \n -28498.3091  56996.6182  57028.6182  57028.6788  57142.2979\n\nVariance components:\n            Column    Variance Std.Dev.   Corr.\nid       (Intercept)   8.391746 2.896851\ncountry  (Intercept)   3.170032 1.780458\n         warmth        0.010609 0.102999   .  \nResidual              26.015906 5.100579\n Number of obs: 9000; levels of grouping factors: 3000, 30\n\n  Fixed-effects parameters:\n──────────────────────────────────────────────────────────────────\n                                Coef.  Std. Error      z  Pr(>|z|)\n──────────────────────────────────────────────────────────────────\n(Intercept)              50.8364       1.48355     34.27    <1e-99\nt                         0.758209     0.326177     2.32    0.0201\nwarmth                    0.817076     0.0826636    9.88    <1e-22\nphysical_punishment      -1.00903      0.111293    -9.07    <1e-18\nidentity                 -0.238714     0.303996    -0.79    0.4323\nintervention              0.660761     0.30445      2.17    0.0300\nHDI                       0.00136065   0.0210842    0.06    0.9485\nt & warmth                0.0483635    0.0356074    1.36    0.1744\nt & physical_punishment   0.000542203  0.0494355    0.01    0.9912\nt & identity              0.0554385    0.131745     0.42    0.6739\nt & intervention          0.0992809    0.131925     0.75    0.4517\nt & HDI                  -0.000955067  0.00382162  -0.25    0.8027\n──────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n:::\n\n## Interpretation\n\nThe *main effects only model* suggests that time is associated with increases in the outcome. In the main effects model, main effects other than time, indicate whether a particular variable is associated with higher or lower intercepts of the time trajectory, at the beginning of the study time. Warmth is again associated with increases in the outcome, while physical punishment is associated with decreases in the outcome. Identity is again not associated with the outcome, while the intervention is associated with higher levels of the outcome. The Human Development Index is again not associated with the outcome.\n\nThe second model adds interactions with time to the first model. Results are largly similar to the prior model. However, here we not only examine whether main effects other than time are associated with higher or lower time trajectories, but also whether particular variables are associated with differences in the slope of the time trajectory. In this case, we find insufficient evidence that any independent variable is associated with changes in the slope of the time trajectory.\n\nHowever, it may be illustrative to imagine how we would interpret the results had a particular interaction term been statistically significant. Let us consider one of the interaction terms with the largest coefficient, `intervention#time`. The interaction of the intervention with time is positive. Had this coefficient been statistically signifcant, it would have indicated that the intervention was associated with more rapid increases in the outcome over time *in addition to* the fact that the intervention is associated with higher initial levels of the outcome.\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "longitudinal-multilingual_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}