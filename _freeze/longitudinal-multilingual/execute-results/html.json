{
  "hash": "21358b65f42e5c1417f69dd549d26fc9",
  "result": {
    "engine": "knitr",
    "markdown": "# Longitudinal Multilevel Models\n\n\n::: {.cell}\n\n:::\n\n\n## The Data\n\nThe data employed in these examples are a longitudinal extension of the data described in @sec-data.\n\n::: {.callout-tip}\n## Graphing Longitudinal Data\n\nIn the section on *cross-sectional* multilevel models, I employed *scatterplots* to graph the data. In longitudinal models, *time* is a variable of special interest. Often, in graphing *longitudinal* data--especially when graphing outcomes by time--it makes more sense to use *linear fit* plots, although a *scatterplot* could be employed as well. \n:::\n\n## The Equation\n\n$$\\text{outcome}_{itj} = \\beta_0 + \\beta_1 \\text{parental warmth}_{itj} + \\beta_2 \\text{physical punishment}_{itj} + \\beta_3 \\text{time}_{itj} \\ + $$ {#eq-MLM-longitudinal} \n\n$$\\beta_4 \\text{group}_{itj} + \\beta_5 \\text{HDI}_{itj} +$$\n\n$$u_{0j} + u_{1j} \\times \\text{parental warmth}_{itj} \\ + $$\n\n$$v_{0i} + v_{1i} \\times \\text{time}_{itj} + e_{itj}$$\n## Run Models\n\n::: {.panel-tabset group=\"language\"}\n\n### Stata\n\n#### Get The Data \n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nuse simulated_multilevel_longitudinal_data.dta\n\n```\n:::\n\n\n#### Graph\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ntwoway lfit outcome t, ///\n  xtitle(\"time\") ytitle(\"outcome\") ///\n  title(\"Outcome by Time\") \n\nquietly graph export lfitlongitudinal.png, replace\n\n```\n:::\n\n\n![Outcome by Parental Warmth (Stata)](lfitlongitudinal.png){#fig-Statalongitudinal}\n\n#### Run The Model\n\n##### Main Effects Only\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nmixed outcome t warmth physical_punishment group HDI || country: warmth\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood =  -28795.37  \nIteration 1:  Log likelihood = -28795.232  \nIteration 2:  Log likelihood = -28795.232  \n\nComputing standard errors ...\n\nMixed-effects ML regression                         Number of obs    =   9,000\nGroup variable: country                             Number of groups =      30\n                                                    Obs per group:\n                                                                 min =     300\n                                                                 avg =   300.0\n                                                                 max =     300\n                                                    Wald chi2(5)     = 1366.93\nLog likelihood = -28795.232                         Prob > chi2      =  0.0000\n\n-------------------------------------------------------------------------------------\n            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n--------------------+----------------------------------------------------------------\n                  t |   .9882371   .0761439    12.98   0.000     .8389979    1.137476\n             warmth |   .9427117   .0342282    27.54   0.000     .8756256    1.009798\nphysical_punishment |  -.9020727   .0452759   -19.92   0.000    -.9908119   -.8133336\n              group |   .9861238   .1249047     7.90   0.000     .7413151    1.230933\n                HDI |   .0073726    .020661     0.36   0.721    -.0331222    .0478674\n              _cons |   49.45537   1.414072    34.97   0.000     46.68384     52.2269\n-------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Independent         |\n                 var(warmth) |   .0024684   .0082517      3.52e-06     1.72956\n                  var(_cons) |   3.663663   .9914845      2.155548     6.22692\n-----------------------------+------------------------------------------------\n               var(Residual) |   34.78483   .5200702       33.7803    35.81923\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(2) = 805.75                Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n##### Interactions With Time\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nmixed outcome c.t##(c.warmth c.physical_punishment i.group c.HDI) || country: warmth\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood =  -28794.99  \nIteration 1:  Log likelihood = -28794.855  \nIteration 2:  Log likelihood = -28794.855  \n\nComputing standard errors ...\n\nMixed-effects ML regression                         Number of obs    =   9,000\nGroup variable: country                             Number of groups =      30\n                                                    Obs per group:\n                                                                 min =     300\n                                                                 avg =   300.0\n                                                                 max =     300\n                                                    Wald chi2(9)     = 1365.73\nLog likelihood = -28794.855                         Prob > chi2      =  0.0000\n\n-------------------------------------------------------------------------------------\n            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n--------------------+----------------------------------------------------------------\n                  t |   1.047448   .3619795     2.89   0.004     .3379816    1.756915\n             warmth |   .8869901   .0876058    10.12   0.000      .715286    1.058694\nphysical_punishment |   -.893285   .1194705    -7.48   0.000    -1.127443    -.659127\n            2.group |   .9648545   .3292217     2.93   0.003     .3195918    1.610117\n                HDI |   .0120622    .022474     0.54   0.591    -.0319861    .0561104\n                    |\n       c.t#c.warmth |   .0277903   .0402665     0.69   0.490    -.0511306    .1067112\n                    |\n                c.t#|\n                 c. |\nphysical_punishment |  -.0041479   .0553051    -0.08   0.940    -.1125439    .1042482\n                    |\n          group#c.t |\n                 2  |   .0105177   .1523009     0.07   0.945    -.2879865    .3090219\n                    |\n          c.t#c.HDI |   -.002342   .0044172    -0.53   0.596    -.0109996    .0063155\n                    |\n              _cons |   50.32233   1.572089    32.01   0.000      47.2411    53.40357\n-------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Independent         |\n                 var(warmth) |   .0025661   .0083259      4.44e-06    1.482773\n                  var(_cons) |    3.66269    .991533      2.154617    6.226305\n-----------------------------+------------------------------------------------\n               var(Residual) |   34.78158   .5200283      33.77713     35.8159\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(2) = 805.90                Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n### R\n\n#### Get The Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\n\ndfL <- read_dta(\"simulated_multilevel_longitudinal_data.dta\")\n```\n:::\n\n\n#### Graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(dfL,\n       aes(x = t,\n           y = outcome)) + \n  geom_smooth(method = \"lm\") +\n  labs(title = \"Outcome by Time\")\n```\n\n::: {.cell-output-display}\n![Outcome by Parental Warmth (R)](longitudinal-multilingual_files/figure-html/fig-Rlongitudinal-1.png){#fig-Rlongitudinal width=672}\n:::\n:::\n\n\n#### Run The Model\n\n##### Main Effects Only\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2A <- lmer(outcome ~ t + warmth + physical_punishment + \n               group + HDI +\n               (1 | country/id),\n             data = dfL)\n\nsummary(fit2A)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: outcome ~ t + warmth + physical_punishment + group + HDI + (1 |  \n    country/id)\n   Data: dfL\n\nREML criterion at convergence: 57088.4\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.4471 -0.6226  0.0081  0.6153  3.1993 \n\nRandom effects:\n Groups     Name        Variance Std.Dev.\n id:country (Intercept)  8.864   2.977   \n country    (Intercept)  3.924   1.981   \n Residual               26.008   5.100   \nNumber of obs: 9000, groups:  id:country, 3000; country, 30\n\nFixed effects:\n                     Estimate Std. Error t value\n(Intercept)         49.494782   1.471780  33.629\nt                    0.987964   0.065840  15.005\nwarmth               0.946259   0.038200  24.771\nphysical_punishment -0.926880   0.049970 -18.549\ngroup                0.985786   0.153550   6.420\nHDI                  0.007543   0.021437   0.352\n\nCorrelation of Fixed Effects:\n            (Intr) t      warmth physc_ group \nt           -0.090                            \nwarmth      -0.085  0.008                     \nphyscl_pnsh -0.085  0.003 -0.019              \ngroup       -0.154  0.000 -0.013 -0.008       \nHDI         -0.943  0.000 -0.003  0.003  0.000\n```\n\n\n:::\n:::\n\n\n##### Interactions With Time\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2B <- lmer(outcome ~ t *(warmth + physical_punishment + \n               group + HDI) +\n               (1 | country/id),\n             data = dfL)\n\nsummary(fit2B)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: outcome ~ t * (warmth + physical_punishment + group + HDI) +  \n    (1 | country/id)\n   Data: dfL\n\nREML criterion at convergence: 57107.3\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.4431 -0.6248  0.0071  0.6183  3.1961 \n\nRandom effects:\n Groups     Name        Variance Std.Dev.\n id:country (Intercept)  8.868   2.978   \n country    (Intercept)  3.925   1.981   \n Residual               26.014   5.100   \nNumber of obs: 9000, groups:  id:country, 3000; country, 30\n\nFixed effects:\n                       Estimate Std. Error t value\n(Intercept)           49.453036   1.637740  30.196\nt                      1.008199   0.364915   2.763\nwarmth                 0.865659   0.080487  10.755\nphysical_punishment   -0.908148   0.110449  -8.222\ngroup                  0.966988   0.304936   3.171\nHDI                    0.012277   0.022761   0.539\nt:warmth               0.040170   0.035364   1.136\nt:physical_punishment -0.008932   0.049262  -0.181\nt:group                0.009180   0.131714   0.070\nt:HDI                 -0.002359   0.003820  -0.618\n\nCorrelation of Fixed Effects:\n            (Intr) t      warmth physc_ group  HDI    t:wrmt t:phy_ t:grop\nt           -0.446                                                        \nwarmth      -0.159  0.278                                                 \nphyscl_pnsh -0.169  0.302 -0.022                                          \ngroup       -0.274  0.459 -0.010 -0.014                                   \nHDI         -0.900  0.227 -0.008  0.009 -0.001                            \nt:warmth     0.141 -0.316 -0.880  0.017  0.010  0.007                     \nt:physcl_pn  0.150 -0.338  0.017 -0.892  0.010 -0.007 -0.015              \nt:group      0.237 -0.532  0.009  0.012 -0.864  0.001 -0.012 -0.008       \nt:HDI        0.302 -0.676  0.018 -0.020  0.002 -0.336 -0.018  0.016 -0.002\n```\n\n\n:::\n:::\n\n\n\n### Julia\n\n#### Get The Data\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nusing Tables, MixedModels, StatFiles, DataFrames, CategoricalArrays, DataFramesMeta\n\ndfL = DataFrame(load(\"simulated_multilevel_longitudinal_data.dta\"))\n```\n:::\n\n\n#### Graph\n\nTo make our plot with a smoother in Julia, we set the `markercolor` and `markerstrokecolor` to be *white*, and the `smooth` option to `:true`.\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nusing StatsPlots\n\n@df dfL scatter(:outcome, :t, \n               title = \"Outcome by Parental Warmth\",\n               ylabel = \"outcome\",\n               xlabel = \"time\",\n               markercolor = \"white\",\n               markerstrokecolor = \"white\",\n               smooth=:true)\n```\n\n::: {.cell-output-display}\n![Outcome by Parental Warmth (Julia)](longitudinal-multilingual_files/figure-html/fig-Julialongitudinal-J1.png){#fig-Julialongitudinal width=300}\n:::\n:::\n\n\n#### Run The Model\n\n##### Change Country To Categorical\n\n\n::: {.cell}\n\n```{.julia .cell-code}\n@transform!(dfL, :country = categorical(:country))\n```\n:::\n\n\n##### Main Effects Only\n\n\n::: {.cell}\n\n```{.julia .cell-code}\n\nm2A = fit(MixedModel, @formula(outcome ~ t + warmth + \n                                 physical_punishment + \n                                 group + HDI +\n                                 (1 + warmth | country) +\n                                 (1 | id)), dfL)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood\n outcome ~ 1 + t + warmth + physical_punishment + group + HDI + (1 + warmth | country) + (1 | id)\n    logLik   -2 logLik      AIC         AICc        BIC     \n -28533.9236  57067.8472  57089.8472  57089.8765  57168.0019\n\nVariance components:\n            Column    Variance Std.Dev.   Corr.\nid       (Intercept)   8.851224 2.975101\ncountry  (Intercept)   3.451345 1.857780\n         warmth        0.000227 0.015065 +1.00\nResidual              26.001212 5.099138\n Number of obs: 9000; levels of grouping factors: 3000, 30\n\n  Fixed-effects parameters:\n──────────────────────────────────────────────────────────────\n                           Coef.  Std. Error       z  Pr(>|z|)\n──────────────────────────────────────────────────────────────\n(Intercept)          49.5105       1.41854     34.90    <1e-99\nt                     0.98814      0.0658319   15.01    <1e-50\nwarmth                0.946252     0.0382851   24.72    <1e-99\nphysical_punishment  -0.926673     0.0499547  -18.55    <1e-76\ngroup                 0.98708      0.153484     6.43    <1e-09\nHDI                   0.00725703   0.0206549    0.35    0.7253\n──────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n##### Interactions With Time\n\n\n::: {.cell}\n\n```{.julia .cell-code}\n\nm2B = fit(MixedModel, @formula(outcome ~ t * (warmth + \n                                 physical_punishment + \n                                 group + HDI) +\n                                 (1 + warmth | country) +\n                                 (1 | id)), dfL)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood\n outcome ~ 1 + t + warmth + physical_punishment + group + HDI + t & warmth + t & physical_punishment + t & group + t & HDI + (1 + warmth | country) + (1 | id)\n    logLik   -2 logLik      AIC         AICc        BIC     \n -28533.0810  57066.1620  57096.1620  57096.2154  57202.7367\n\nVariance components:\n            Column    Variance   Std.Dev.   Corr.\nid       (Intercept)   8.8593774 2.9764706\ncountry  (Intercept)   3.4464818 1.8564703\n         warmth        0.0002394 0.0154717 +1.00\nResidual              25.9905210 5.0980899\n Number of obs: 9000; levels of grouping factors: 3000, 30\n\n  Fixed-effects parameters:\n─────────────────────────────────────────────────────────────────\n                               Coef.  Std. Error      z  Pr(>|z|)\n─────────────────────────────────────────────────────────────────\n(Intercept)              49.4696      1.59007     31.11    <1e-99\nt                         1.00761     0.36475      2.76    0.0057\nwarmth                    0.865294    0.0804999   10.75    <1e-26\nphysical_punishment      -0.907816    0.110399    -8.22    <1e-15\ngroup                     0.96908     0.304797     3.18    0.0015\nHDI                       0.0119739   0.0220306    0.54    0.5868\nt & warmth                0.0403499   0.0353477    1.14    0.2537\nt & physical_punishment  -0.00900605  0.0492392   -0.18    0.8549\nt & group                 0.00879803  0.131655     0.07    0.9467\nt & HDI                  -0.00234513  0.00381848  -0.61    0.5391\n─────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n:::\n\n\n",
    "supporting": [
      "longitudinal-multilingual_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}