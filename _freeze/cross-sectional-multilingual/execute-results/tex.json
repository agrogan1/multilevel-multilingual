{
  "hash": "b3b41e92031e9efb9f404aadd2f5ce0b",
  "result": {
    "engine": "knitr",
    "markdown": "# Cross Sectional Multilevel Models\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## The Equation\n\nRecall the general model of @eq-MLMsimple, and the syntax outlined in @sec-syntax. Below in @eq-MLMsubstantive, we consider a more substantive example.\n\n$$\\text{outcome}_{ij}= \\beta_0 + \\beta_1 \\text{warmth}_{ij} +$$ {#eq-MLMsubstantive}\n\n$$\\beta_2 \\text{physical punishment}_{ij} +$$\n\n$$\\beta_3 \\text{group}_{ij} + \\beta_4 \\text{HDI}_{ij} +$$\n\n$$u_{0j} + u_{1j} \\times \\text{warmth}_{ij} + e_{ij}$$ \n\n## Correlated and Uncorrelated Random Effects\n\nConsider the covariance matrix of random effects (e.g. $u_{0j}$ and $u_{1j}$). In @eq-varcovar the covariances of the random effects are constrained to be zero.\n\n$$\\begin{bmatrix}\nvar(u_{0j}) & 0 \\\\\n0 & var(u_{1j}) \n\\end{bmatrix}$$ {#eq-varcovar}\n\nAs discussed in Chapter 6, however, one can consider a multilevel model in which the random effects are correlated, as is the case in @eq-varcovaruns.\n\n$$\\begin{bmatrix}\nvar(u_{0j}) & cov(u_{0j}, u_{1j}) \\\\\ncov(u_{0j}, u_{1j}) & var(u_{1j}) \n\\end{bmatrix}$$ {#eq-varcovaruns}\n\nProcedures for estimating models with uncorrelated and correlated random effects are detailed below [@StataCorp2021:2; @JSSv067i01; @MixedModels].\n\n-------------------------------------------------------------\nSoftware    Uncorrelated          Correlated\n            Random                Random\n            Effects               Effects\n----------- --------------------- ---------------------------\nStata       default               add option: `, cov(uns)`\n\nR           separate random       separate random \n            effects from          effects from\n            grouping variable     grouping variable\n            with `||`             with `|`\n\nJulia       separate terms        separate random \n            for each random       effects from\n            effect e.g.           grouping variable\n            `(1 | group) +`       with `|`.\n            `(0 + x | group)`\n-------------------------------------------------------------\n\n: Correlated and Uncorrelated Random Effects {#tbl-REs}\n\nAll models in the examples below are run with *uncorrelated* random effects, but could just as easily be run with *correlated* random effects. \n\n## Run Models\n\n::: {.panel-tabset group=\"language\"}\n\n### Stata\n\n#### Get The Data \n\n\n\n::: {.cell collectcode='true'}\n\n```{.stata .cell-code}\n\nuse simulated_multilevel_data.dta\n\n```\n:::\n\n\n\n#### Run The Model\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nmixed outcome warmth physical_punishment group HDI || country: warmth\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood =  -9668.198  \nIteration 1:  Log likelihood = -9667.9551  \nIteration 2:  Log likelihood = -9667.9534  \nIteration 3:  Log likelihood = -9667.9533  \nIteration 4:  Log likelihood = -9667.9532  \n\nComputing standard errors ...\n\nMixed-effects ML regression                          Number of obs    =  3,000\nGroup variable: country                              Number of groups =     30\n                                                     Obs per group:\n                                                                  min =    100\n                                                                  avg =  100.0\n                                                                  max =    100\n                                                     Wald chi2(4)     = 401.26\nLog likelihood = -9667.9532                          Prob > chi2      = 0.0000\n\n-------------------------------------------------------------------------------------\n            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n--------------------+----------------------------------------------------------------\n             warmth |   .9616447   .0581825    16.53   0.000     .8476091     1.07568\nphysical_punishment |  -.8453802   .0798155   -10.59   0.000    -1.001816   -.6889448\n              group |   1.084344   .2200539     4.93   0.000     .6530461    1.515642\n                HDI |    .010557   .0204522     0.52   0.606    -.0295286    .0506426\n              _cons |   49.87963   1.436612    34.72   0.000     47.06392    52.69534\n-------------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Independent         |\n                 var(warmth) |   1.83e-06   .0000173      1.76e-14    190.9774\n                  var(_cons) |   3.370262   .9633726      1.924651    5.901676\n-----------------------------+------------------------------------------------\n               var(Residual) |   36.01906   .9346936      34.23291    37.89842\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(2) = 198.01                Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n```\n\n\n:::\n:::\n\n\n\n### R\n\n#### Get The Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\n\ndf <- read_dta(\"simulated_multilevel_data.dta\")\n```\n:::\n\n\n\n#### Run The Model\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit1 <- lmer(outcome ~ warmth + physical_punishment + \n               group + HDI +\n               (1 + warmth || country),\n             data = df)\n\nsummary(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: outcome ~ warmth + physical_punishment + group + HDI + ((1 |  \n    country) + (0 + warmth | country))\n   Data: df\n\nREML criterion at convergence: 19350.3\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.4496 -0.6807  0.0016  0.6864  3.1792 \n\nRandom effects:\n Groups    Name        Variance  Std.Dev.\n country   (Intercept)  3.611568 1.90041 \n country.1 warmth       0.001876 0.04331 \n Residual              36.049124 6.00409 \nNumber of obs: 3000, groups:  country, 30\n\nFixed effects:\n                    Estimate Std. Error t value\n(Intercept)         49.88754    1.48203  33.662\nwarmth               0.96155    0.05875  16.367\nphysical_punishment -0.84556    0.07986 -10.588\ngroup                1.08471    0.22017   4.927\nHDI                  0.01044    0.02116   0.493\n\nCorrelation of Fixed Effects:\n            (Intr) warmth physc_ group \nwarmth      -0.126                     \nphyscl_pnsh -0.135 -0.025              \ngroup       -0.218 -0.010 -0.019       \nHDI         -0.925 -0.006  0.008 -0.001\n```\n\n\n:::\n:::\n\n\n\n### Julia\n\n#### Get The Data\n\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nusing Tables, MixedModels, StatFiles, DataFrames, CategoricalArrays, DataFramesMeta\n\ndf = DataFrame(load(\"simulated_multilevel_data.dta\"))\n```\n:::\n\n\n\n#### Change Country To Categorical\n\n\n\n::: {.cell}\n\n```{.julia .cell-code}\n@transform!(df, :country = categorical(:country))\n```\n:::\n\n\n\n#### Run The Model\n\n\n\n::: {.cell}\n\n```{.julia .cell-code}\n\nm1 = fit(MixedModel, @formula(outcome ~ warmth + physical_punishment + \n               group + HDI +\n               (1 | country) +\n               (0 + warmth | country)), df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood\n outcome ~ 1 + warmth + physical_punishment + group + HDI + (1 | country) + (0 + warmth | country)\n   logLik   -2 logLik     AIC       AICc        BIC    \n -9667.9532 19335.9065 19351.9065 19351.9546 19399.9574\n\nVariance components:\n            Column   Variance Std.Dev.  Corr.\ncountry  (Intercept)   3.36982 1.83571\n         warmth        0.00000 0.00000   .  \nResidual              36.01912 6.00159\n Number of obs: 3000; levels of grouping factors: 30\n\n  Fixed-effects parameters:\n─────────────────────────────────────────────────────────────\n                          Coef.  Std. Error       z  Pr(>|z|)\n─────────────────────────────────────────────────────────────\n(Intercept)          49.8796      1.43653     34.72    <1e-99\nwarmth                0.961645    0.058182    16.53    <1e-60\nphysical_punishment  -0.84538     0.0798155  -10.59    <1e-25\ngroup                 1.08434     0.220054     4.93    <1e-06\nHDI                   0.0105571   0.0204509    0.52    0.6057\n─────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n\n\n:::\n\n\n\n\n\n",
    "supporting": [
      "cross-sectional-multilingual_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}