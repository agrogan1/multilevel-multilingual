{
  "hash": "95bf27723c0855a3cb5d58e1d04d182b",
  "result": {
    "engine": "knitr",
    "markdown": "# Unconditional Models\n\n## Two Level Model\n\nAn *unconditional* multilevel model is a model with no independent variables. One should always run an unconditional model as the first step of a multilevel model in order to get a sense of the way that variation is apportioned in the model across the different levels.\n\n### The Equation\n\n$$\\text{outcome}_{ij}= \\beta_0 + u_{0j} + e_{ij}$$ {#eq-MLMunconditional}\n\nThe Intraclass Correlation Coefficient (ICC) is given by:\n\n$$\\text{ICC} = \\frac{var(u_{0j})}{var(u_{0j}) + var(e_{ij})}$$ {#eq-ICCunconditional}\n\nIn a two level multilevel model, the ICC provides a measure of the proportion of variation attributable to Level 2.\n\n\n::: {.cell}\n\n:::\n\n\n### Run Models\n\n::: {.panel-tabset group=\"language\"}\n\n#### Stata\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nuse simulated_multilevel_data.dta // use data\n\nmixed outcome || country:  // unconditional model\n\nestat icc // ICC\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood = -9802.8371  \nIteration 1:  Log likelihood = -9802.8371  \n\nComputing standard errors ...\n\nMixed-effects ML regression                           Number of obs    = 3,000\nGroup variable: country                               Number of groups =    30\n                                                      Obs per group:\n                                                                   min =   100\n                                                                   avg = 100.0\n                                                                   max =   100\n                                                      Wald chi2(0)     =     .\nLog likelihood = -9802.8371                           Prob > chi2      =     .\n\n------------------------------------------------------------------------------\n     outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n       _cons |   52.43327   .3451217   151.93   0.000     51.75685     53.1097\n------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Identity            |\n                  var(_cons) |   3.178658   .9226737      1.799552    5.614658\n-----------------------------+------------------------------------------------\n               var(Residual) |   39.46106   1.024013      37.50421       41.52\n------------------------------------------------------------------------------\nLR test vs. linear model: chibar2(01) = 166.31        Prob >= chibar2 = 0.0000\n\n\nIntraclass correlation\n\n------------------------------------------------------------------------------\n                       Level |        ICC   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\n                     country |   .0745469   .0201254      .0434963    .1248696\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n#### R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\n\ndf <- read_dta(\"simulated_multilevel_data.dta\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4) # estimate multilevel models\n\nfit0 <- lmer(outcome ~ (1 | country),\n             data = df) # unconditional model\n\nsummary(fit0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: outcome ~ (1 | country)\n   Data: df\n\nREML criterion at convergence: 19605.9\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.3844 -0.6655 -0.0086  0.6725  3.6626 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n country  (Intercept)  3.302   1.817   \n Residual             39.461   6.282   \nNumber of obs: 3000, groups:  country, 30\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)   52.433      0.351   149.4\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(performance)\n\nperformance::icc(fit0) # ICC\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Intraclass Correlation Coefficient\n\n    Adjusted ICC: 0.077\n  Unadjusted ICC: 0.077\n```\n\n\n:::\n:::\n\n\n#### Julia\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nusing Tables, MixedModels, MixedModelsExtras, \nStatFiles, DataFrames, CategoricalArrays, DataFramesMeta\n\ndf = DataFrame(load(\"simulated_multilevel_data.dta\"))\n```\n:::\n\n::: {.cell}\n\n```{.julia .cell-code}\n@transform!(df, :country = categorical(:country))\n```\n:::\n\n::: {.cell}\n\n```{.julia .cell-code}\n\nm0 = fit(MixedModel, \n         @formula(outcome ~ (1 | country)), df) # unconditional model\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood\n outcome ~ 1 + (1 | country)\n   logLik   -2 logLik     AIC       AICc        BIC    \n -9802.8371 19605.6742 19611.6742 19611.6822 19629.6933\n\nVariance components:\n            Column   Variance Std.Dev.\ncountry  (Intercept)   3.17863 1.78287\nResidual              39.46106 6.28180\n Number of obs: 3000; levels of grouping factors: 30\n\n  Fixed-effects parameters:\n──────────────────────────────────────────────────\n               Coef.  Std. Error       z  Pr(>|z|)\n──────────────────────────────────────────────────\n(Intercept)  52.4333    0.345121  151.93    <1e-99\n──────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.julia .cell-code}\n\nicc(m0) # ICC\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.07454637475695493\n```\n\n\n:::\n:::\n\n\n:::\n\n### Interpretation\n\nIn each case, the software finds that nearly 8% of the variation in the outcome is explainable by the clustering of the observations in each country.\n\n## Three Level Model\n\n### The Equation\n\n$$\\text{outcome}_{ij}= \\beta_0 + u_{0j} + v_{0i} + e_{ij}$$ {#eq-MLMunconditional3}\n\nAs discussed in the main text, in a three level model, there are two intraclass correlation coefficients [@StataCorp2023]. The formulas for the Intraclass Correlation Coefficient (ICC) are given by [@StataCorp2023]:\n\n$$\\text{ICC} = \\frac{var(u_{0j})}{var(u_{0j}) + var(v_{0i}) + var(e_{ij})}$$ {#eq-ICCunconditional3A}\n\nAgain, following @StataCorp2023, @eq-ICCunconditional3A is the correlation of responses for person-timepoints from the same country but different persons.\n\n$$\\text{ICC} = \\frac{var(u_{0j}) + var(v_{0i})}{var(u_{0j}) + var(v_{0i}) + var(e_{ij})}$$ {#eq-ICCunconditional3B}\n\nAgain, closely following @StataCorp2023, @eq-ICCunconditional3B is the correlation of responses for person-timepoints from the same country and same person.\n\n### Run Models\n\n::: {.panel-tabset group=\"language\"}\n\n#### Stata\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nuse simulated_multilevel_longitudinal_data.dta // use data\n\nmixed outcome || country: || id: // unconditional model\n  \nestat icc // ICC\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPerforming EM optimization ...\n\nPerforming gradient-based optimization: \nIteration 0:  Log likelihood = -29058.266  \nIteration 1:  Log likelihood = -29058.259  \nIteration 2:  Log likelihood = -29058.259  \n\nComputing standard errors ...\n\nMixed-effects ML regression                              Number of obs = 9,000\n\n        Grouping information\n        -------------------------------------------------------------\n                        |     No. of       Observations per group\n         Group variable |     groups    Minimum    Average    Maximum\n        ----------------+--------------------------------------------\n                country |         30        300      300.0        300\n                     id |      3,000          3        3.0          3\n        -------------------------------------------------------------\n\n                                                         Wald chi2(0)  =     .\nLog likelihood = -29058.259                              Prob > chi2   =     .\n\n------------------------------------------------------------------------------\n     outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n       _cons |   53.37768   .3387943   157.55   0.000     52.71366    54.04171\n------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\ncountry: Identity            |\n                  var(_cons) |   3.232092   .8891367      1.885043     5.54174\n-----------------------------+------------------------------------------------\nid: Identity                 |\n                  var(_cons) |   11.72403   .5747501      10.64996    12.90641\n-----------------------------+------------------------------------------------\n               var(Residual) |   28.23424   .5154843      27.24178    29.26287\n------------------------------------------------------------------------------\nLR test vs. linear model: chi2(2) = 1314.88               Prob > chi2 = 0.0000\n\nNote: LR test is conservative and provided only for reference.\n\n\nIntraclass correlation\n\n------------------------------------------------------------------------------\n                       Level |        ICC   Std. err.     [95% conf. interval]\n-----------------------------+------------------------------------------------\n                     country |   .0748336   .0190847      .0450028    .1219141\n                  id|country |   .3462837   .0171461      .3134867    .3806097\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n#### R\n\nIn R, the ICC for a three level model is easiest to estimate \"by hand\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\n\ndfL <- read_dta(\"simulated_multilevel_longitudinal_data.dta\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4) # estimate multilevel models\n\nfit0L <- lmer(outcome ~ (1 | country/id),\n             data = dfL) # unconditional model\n\nsummary(fit0L)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: outcome ~ (1 | country/id)\n   Data: dfL\n\nREML criterion at convergence: 58116.8\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.7858 -0.6059 -0.0062  0.6017  3.4348 \n\nRandom effects:\n Groups     Name        Variance Std.Dev.\n id:country (Intercept) 11.724   3.424   \n country    (Intercept)  3.351   1.830   \n Residual               28.234   5.314   \nNumber of obs: 9000, groups:  id:country, 3000; country, 30\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  53.3777     0.3446   154.9\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n3.351 / (11.724 + 3.351 + 28.234)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.07737422\n```\n\n\n:::\n\n```{.r .cell-code}\n(3.351 + 11.724) / (11.724 + 3.351 + 28.234)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3480801\n```\n\n\n:::\n:::\n\n\n#### Julia\n\nIn Julia, the ICC for a three level model is also easiest to estimate \"by hand\".\n\n\n::: {.cell}\n\n```{.julia .cell-code}\nusing Tables, MixedModels, StatFiles, DataFrames, CategoricalArrays, DataFramesMeta\n\ndfL = DataFrame(load(\"simulated_multilevel_longitudinal_data.dta\"))\n```\n:::\n\n::: {.cell}\n\n```{.julia .cell-code}\n@transform!(dfL, :country = categorical(:country))\n```\n:::\n\n::: {.cell}\n\n```{.julia .cell-code}\n\nm0L = fit(MixedModel, @formula(outcome ~ \n                                 (1 | country) + \n                                 (1 | id)), dfL)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood\n outcome ~ 1 + (1 | country) + (1 | id)\n    logLik   -2 logLik      AIC         AICc        BIC     \n -29058.2592  58116.5184  58124.5184  58124.5229  58152.9384\n\nVariance components:\n            Column   Variance Std.Dev.\nid       (Intercept)  11.72401 3.42403\ncountry  (Intercept)   3.23190 1.79775\nResidual              28.23426 5.31359\n Number of obs: 9000; levels of grouping factors: 3000, 30\n\n  Fixed-effects parameters:\n──────────────────────────────────────────────────\n               Coef.  Std. Error       z  Pr(>|z|)\n──────────────────────────────────────────────────\n(Intercept)  53.3777    0.338785  157.56    <1e-99\n──────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.julia .cell-code}\n\n3.23190 / (11.72401 + 3.23190 + 28.23426)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.07482952718176382\n```\n\n\n:::\n\n```{.julia .cell-code}\n\n(3.23190 + 11.72401) / (11.72401 + 3.23190 + 28.23426)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.34628041519632824\n```\n\n\n:::\n:::\n\n\n:::\n\n### Interpretation\n\nEach software suggests that almost 8% of the variation in the outcome is within time points for different individuals within the same country, while almost 35% of the variation in the outcome is within time points for the same individual within the same country. \n\n\n\n",
    "supporting": [
      "unconditional-multilingual_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}