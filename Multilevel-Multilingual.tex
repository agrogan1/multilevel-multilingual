% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrreprt}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % set entry spacing
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\@ifpackageloaded{fontawesome5}{}{\usepackage{fontawesome5}}
\definecolor{quarto-callout-color}{HTML}{909090}
\definecolor{quarto-callout-note-color}{HTML}{0758E5}
\definecolor{quarto-callout-important-color}{HTML}{CC1914}
\definecolor{quarto-callout-warning-color}{HTML}{EB9113}
\definecolor{quarto-callout-tip-color}{HTML}{00A047}
\definecolor{quarto-callout-caution-color}{HTML}{FC5300}
\definecolor{quarto-callout-color-frame}{HTML}{acacac}
\definecolor{quarto-callout-note-color-frame}{HTML}{4582ec}
\definecolor{quarto-callout-important-color-frame}{HTML}{d9534f}
\definecolor{quarto-callout-warning-color-frame}{HTML}{f0ad4e}
\definecolor{quarto-callout-tip-color-frame}{HTML}{02b875}
\definecolor{quarto-callout-caution-color-frame}{HTML}{fd7e14}
\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Multilevel Multilingual},
  pdfauthor={Andrew Grogan-Kaylor},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Multilevel Multilingual}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{Multilevel Models in Stata, R and Julia}
\author{Andrew Grogan-Kaylor}
\date{2024-04-07}

\begin{document}
\maketitle

\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\listoftables
\bookmarksetup{startatroot}

\chapter{Multilevel Multilingual}\label{multilevel-multilingual}

\begin{quote}
``This curious world which we inhabit is more wonderful than it is
convenient\ldots{}'' (Thoreau, 1975)
\end{quote}

\begin{quote}
``Mathematics is my secret. My secret weakness. I feel like a stubborn,
helpless fool in the middle of a problem. Trapped and crazed. Also,
thrilled.'' (Schanen, 2021)
\end{quote}

\section{Introduction}\label{introduction}

Below, I describe the use of \href{https://www.stata.com/}{Stata}
(StataCorp, 2021), \href{https://www.r-project.org/}{R} (Bates et al.,
2015; R Core Team, 2023), and \href{https://www.julialang.org/}{Julia}
(Bates, 2024; Bezanson et al., 2017) to estimate multilevel models.

All of these software packages can estimate multilevel models. However,
there are substantial differences between the different packages: Stata
is proprietary \emph{for cost} software, which is very well documented
and very intuitive. R is free open source software which is less
intuitive, but there are many excellent resources for learning R. Julia
is newer open source software, and ostensibly much faster than either
Stata or R, which may be an important advantage when running multilevel
models with very large data sets. At this point in time, both Stata and
R feel much more \emph{stable} than Julia which is still evolving
software.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.1667}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.1528}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.5417}}@{}}
\caption{Software for Multilevel
Modeling}\label{tbl-software}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Software
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Cost
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Ease of Use
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Software
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Cost
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Ease of Use
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Stata & some cost & learning curve, but intuitive for both multilevel
modeling and graphing. \\
R & free & learning curve: intuitive for multilevel modeling; but
steeper learning curve for graphing. \\
Julia & free & learning curve: steeper learning curve for multilevel
modeling; and very steep learning curve for graphing. Graphics libraries
are very much under development and in flux. \\
\end{longtable}

\begin{tcolorbox}[enhanced jigsaw, colframe=quarto-callout-tip-color-frame, left=2mm, colback=white, rightrule=.15mm, opacityback=0, coltitle=black, title=\textcolor{quarto-callout-tip-color}{\faLightbulb}\hspace{0.5em}{Results Will Vary Somewhat}, titlerule=0mm, bottomrule=.15mm, breakable, opacitybacktitle=0.6, arc=.35mm, bottomtitle=1mm, toprule=.15mm, colbacktitle=quarto-callout-tip-color!10!white, toptitle=1mm, leftrule=.75mm]

Estimating multilevel models is a complex endeavor. The software details
of how this is accomplished are beyond the purview of this book. Suffice
it to say that across different software packages there will be
differences in estimation routines, resulting in some numerical
differences in the results provided by different software packages.
Substantively speaking, however, results should agree across software.

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, colframe=quarto-callout-tip-color-frame, left=2mm, colback=white, rightrule=.15mm, opacityback=0, coltitle=black, title=\textcolor{quarto-callout-tip-color}{\faLightbulb}\hspace{0.5em}{Multi-Line Commands}, titlerule=0mm, bottomrule=.15mm, breakable, opacitybacktitle=0.6, arc=.35mm, bottomtitle=1mm, toprule=.15mm, colbacktitle=quarto-callout-tip-color!10!white, toptitle=1mm, leftrule=.75mm]

Sometimes I have written commands out over multiple lines. I have done
this for especially long commands, but have also sometimes done this
simply for the sake of clarity. The different software packages have
different approaches to multi-line commands.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  By default, \emph{Stata} ends a command at the end of a line. If you
  are going to write a multi-line command you should use the
  \texttt{///} line continuation characters.
\item
  \emph{R} is the software that most naturally can be written using
  multiple lines, as R commands are usually clearly encased in
  parentheses (\texttt{()}) or continued with \texttt{+} signs.
\item
  Like \emph{Stata}, \emph{Julia} expects commands to end at the end of
  a line. If you are going to write a mult-line command, all commands
  except for the last line should end in a character that clearly
  indicates continuation, like a \texttt{+} sign. An alternative is to
  encase the entire Julia command in an outer set of parentheses
  (\texttt{()}).
\end{enumerate}

\end{tcolorbox}

\section{The Data}\label{sec-data}

The examples use the \texttt{simulated\_multilevel\_data.dta} file from
\href{https://agrogan1.github.io/multilevel-thinking/simulated-multi-country-data.html}{\emph{Multilevel
Thinking}}. Here is a
\href{https://github.com/agrogan1/multilevel-multilingual/raw/main/simulated_multilevel_data.dta}{direct
link} to download the data.

\begin{longtable}[]{@{}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1250}}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0750}}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1125}}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0750}}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1000}}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.2750}}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1125}}
  >{\centering\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1250}}@{}}

\caption{\label{tbl-multilingual1}Sample of Simulated Multilevel Data}

\tabularnewline

\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\centering
country
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
HDI
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
family
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
id
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
group
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
physical\_punishment
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
warmth
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
outcome
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
1 & 69 & 1 & 1.1 & 2 & 2 & 3 & 59.18 \\
1 & 69 & 2 & 1.2 & 2 & 4 & 0 & 61.54 \\
1 & 69 & 3 & 1.3 & 1 & 4 & 4 & 51.87 \\
1 & 69 & 4 & 1.4 & 2 & 0 & 6 & 51.71 \\
1 & 69 & 5 & 1.5 & 2 & 3 & 2 & 55.88 \\
1 & 69 & 6 & 1.6 & 1 & 5 & 3 & 60.78 \\

\end{longtable}

\section{An Introduction To Equations and Syntax}\label{sec-syntax}

To explain statistical syntax for each software, I consider the general
case of a multilevel model with dependent variable \texttt{y},
independent variables \texttt{x} and \texttt{z}, clustering variable
\texttt{group}, and a random slope for \texttt{x}. \emph{i} is the index
for the person, while \emph{j} is the index for the \texttt{group}.

\begin{equation}\phantomsection\label{eq-MLMsimple}{y = \beta_0 + \beta_1 x_{ij} + \beta_2 z_{ij} + u_{0j} + u_{1j} \times x_{ij} + e_{ij}}\end{equation}

\subsection{Stata}

In Stata \texttt{mixed}, the syntax for a multilevel model of the form
described in Equation~\ref{eq-MLMsimple} is:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mixed }\FunctionTok{y}\NormalTok{ x || }\FunctionTok{group}\NormalTok{: x}
\end{Highlighting}
\end{Shaded}

\subsection{R}

In R \texttt{lme4}, the general syntax for a multilevel model of the
form described in Equation~\ref{eq-MLMsimple} is:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lme4)}

\FunctionTok{lmer}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ z }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ x }\SpecialCharTok{||}\NormalTok{ group), }\AttributeTok{data =}\NormalTok{ ...)}
\end{Highlighting}
\end{Shaded}

\subsection{Julia}

In Julia \texttt{MixedModels}, the general syntax for a multilevel model
of the form described in Equation~\ref{eq-MLMsimple} is:

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{using} \BuiltInTok{MixedModels}

\FunctionTok{fit}\NormalTok{(MixedModel, }\PreprocessorTok{@formula}\NormalTok{(y }\OperatorTok{\textasciitilde{}}\NormalTok{ x }\OperatorTok{+}\NormalTok{ z }\OperatorTok{+}\NormalTok{ (}\FloatTok{1} \OperatorTok{+}\NormalTok{ x }\OperatorTok{|}\NormalTok{ group)), data)}
\end{Highlighting}
\end{Shaded}

\bookmarksetup{startatroot}

\chapter{Descriptive Statistics}\label{descriptive-statistics}

\section{Descriptive Statistics}\label{descriptive-statistics-1}

\subsection{Stata}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{use}\NormalTok{ simulated\_multilevel\_data.dta }\CommentTok{// use data}
\end{Highlighting}
\end{Shaded}

We use \texttt{summarize} for \emph{continuous} variables, and
\texttt{tabulate} for \emph{categorical} variables.

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{summarize}\NormalTok{ outcome warmth physical\_punishment HDI}

\KeywordTok{tabulate} \FunctionTok{group}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     outcome |      3,000    53.46757     6.65179   33.39014   76.75101
      warmth |      3,000    3.524333    1.889956          0          7
physical_p~t |      3,000    2.494667    1.380075          0          5
         HDI |      3,000    64.76667    17.24562         33         87


  arbitrary |
      group |
   variable |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,507       50.23       50.23
          2 |      1,493       49.77      100.00
------------+-----------------------------------
      Total |      3,000      100.00
\end{verbatim}

\subsection{R}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven) }\CommentTok{\# read data in Stata format}

\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"simulated\_multilevel\_data.dta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

R's descriptive statistics functions rely heavily on whether a variable
is a \emph{numeric} variable, or a \emph{factor} variable. Below, I
convert two variables to factors (\texttt{factor}) before using
\texttt{summary}\footnote{\texttt{skimr} is an excellent new alternative
  library for generating descriptive statistics in R.} to generate
descriptive statistics.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df}\SpecialCharTok{$}\NormalTok{country }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{country)}

\NormalTok{df}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{group)}

\FunctionTok{summary}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    country          HDI            family            id            group   
 1      : 100   Min.   :33.00   Min.   :  1.00   Length:3000        1:1507  
 2      : 100   1st Qu.:53.00   1st Qu.: 25.75   Class :character   2:1493  
 3      : 100   Median :70.00   Median : 50.50   Mode  :character           
 4      : 100   Mean   :64.77   Mean   : 50.50                              
 5      : 100   3rd Qu.:81.00   3rd Qu.: 75.25                              
 6      : 100   Max.   :87.00   Max.   :100.00                              
 (Other):2400                                                               
 physical_punishment     warmth         outcome     
 Min.   :0.000       Min.   :0.000   Min.   :33.39  
 1st Qu.:2.000       1st Qu.:2.000   1st Qu.:48.78  
 Median :3.000       Median :4.000   Median :53.64  
 Mean   :2.495       Mean   :3.524   Mean   :53.47  
 3rd Qu.:3.250       3rd Qu.:5.000   3rd Qu.:58.06  
 Max.   :5.000       Max.   :7.000   Max.   :76.75  
                                                    
\end{verbatim}

\subsection{Julia}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{using} \BuiltInTok{Tables}\NormalTok{, }\BuiltInTok{MixedModels}\NormalTok{, }\BuiltInTok{MixedModelsExtras}\NormalTok{, }\BuiltInTok{StatFiles}\NormalTok{, }\BuiltInTok{DataFrames}\NormalTok{, }\BuiltInTok{CategoricalArrays}\NormalTok{, }\BuiltInTok{DataFramesMeta}

\NormalTok{df }\OperatorTok{=} \FunctionTok{DataFrame}\NormalTok{(}\FunctionTok{load}\NormalTok{(}\StringTok{"simulated\_multilevel\_data.dta"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Similarly to R, Julia relies on the idea of \emph{variable type}. I use
\texttt{transform} to convert the appropriate variables to
\emph{categorical} variables.

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{@transform}\NormalTok{!(df, }\OperatorTok{:}\NormalTok{country }\OperatorTok{=} \FunctionTok{categorical}\NormalTok{(}\OperatorTok{:}\NormalTok{country))}

\PreprocessorTok{@transform}\NormalTok{!(df, }\OperatorTok{:}\NormalTok{group }\OperatorTok{=} \FunctionTok{categorical}\NormalTok{(}\OperatorTok{:}\NormalTok{group))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]

\FunctionTok{describe}\NormalTok{(df) }\CommentTok{\# descriptive statistics}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
8×7 DataFrame
 Row │ variable             mean     min      median   max     nmissing  eltyp ⋯
     │ Symbol               Union…   Any      Union…   Any     Int64     Union ⋯
─────┼──────────────────────────────────────────────────────────────────────────
   1 │ country                       1.0               30.0           0  Union ⋯
   2 │ HDI                  64.7667  33.0     70.0     87.0           0  Union
   3 │ family               50.5     1.0      50.5     100.0          0  Union
   4 │ id                            1.1               9.99           0  Union
   5 │ group                         1.0               2.0            0  Union ⋯
   6 │ physical_punishment  2.49467  0.0      3.0      5.0            0  Union
   7 │ warmth               3.52433  0.0      4.0      7.0            0  Union
   8 │ outcome              53.4676  33.3901  53.6426  76.751         0  Union
                                                                1 column omitted
\end{verbatim}

\bookmarksetup{startatroot}

\chapter{Unconditional Model}\label{unconditional-model}

An \emph{unconditional} multilevel model is a model with no independent
variables. One should always run an unconditional model as the first
step of a multilevel model in order to get a sense of the way that
variation is apportioned in the model across the different levels.

\section{The Equation}\label{the-equation}

\begin{equation}\phantomsection\label{eq-MLMunconditional}{\text{outcome}_{ij}= \beta_0 + u_{0j} + e_{ij}}\end{equation}

The Intraclass Correlation Coefficient (ICC) is given by:

\begin{equation}\phantomsection\label{eq-ICCunconditional}{\text{ICC} = \frac{var(u_{0j})}{var(u_{0j}) + var(e_{ij})}}\end{equation}

In a two level multilevel model, the ICC provides a measure of the
amount of variation attributable to Level 2.

\section{Run Models}\label{run-models}

\subsection{Stata}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{use}\NormalTok{ simulated\_multilevel\_data.dta }\CommentTok{// use data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mixed outcome || country: }\CommentTok{// unconditional model}
  
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood = -9856.1548  
Iteration 1:  Log likelihood = -9856.1548  

Computing standard errors ...

Mixed-effects ML regression                           Number of obs    = 3,000
Group variable: country                               Number of groups =    30
                                                      Obs per group:
                                                                   min =   100
                                                                   avg = 100.0
                                                                   max =   100
                                                      Wald chi2(0)     =     .
Log likelihood = -9856.1548                           Prob > chi2      =     .

------------------------------------------------------------------------------
     outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       _cons |   53.46757   .3539097   151.08   0.000     52.77392    54.16122
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Identity            |
                  var(_cons) |   3.348734   .9702594      1.897816    5.908906
-----------------------------+------------------------------------------------
               var(Residual) |   40.88284   1.060908       38.8555    43.01597
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 169.64        Prob >= chibar2 = 0.0000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
  
\KeywordTok{estat}\NormalTok{ icc }\CommentTok{// ICC}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Intraclass correlation

------------------------------------------------------------------------------
                       Level |        ICC   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
                     country |   .0757091   .0203761      .0442419    .1265931
------------------------------------------------------------------------------
\end{verbatim}

\subsection{R}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}

\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"simulated\_multilevel\_data.dta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lme4) }\CommentTok{\# estimate multilevel models}

\NormalTok{fit0 }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(outcome }\SpecialCharTok{\textasciitilde{}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ country),}
             \AttributeTok{data =}\NormalTok{ df) }\CommentTok{\# unconditional model}

\FunctionTok{summary}\NormalTok{(fit0)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by REML ['lmerMod']
Formula: outcome ~ (1 | country)
   Data: df

REML criterion at convergence: 19712.5

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.97650 -0.68006  0.00936  0.67580  3.03510 

Random effects:
 Groups   Name        Variance Std.Dev.
 country  (Intercept)  3.478   1.865   
 Residual             40.883   6.394   
Number of obs: 3000, groups:  country, 30

Fixed effects:
            Estimate Std. Error t value
(Intercept)    53.47       0.36   148.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(performance)}

\NormalTok{performance}\SpecialCharTok{::}\FunctionTok{icc}\NormalTok{(fit0) }\CommentTok{\# ICC}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# Intraclass Correlation Coefficient

    Adjusted ICC: 0.078
  Unadjusted ICC: 0.078
\end{verbatim}

\subsection{Julia}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{using} \BuiltInTok{Tables}\NormalTok{, }\BuiltInTok{MixedModels}\NormalTok{, }\BuiltInTok{MixedModelsExtras}\NormalTok{, }
\BuiltInTok{StatFiles}\NormalTok{, }\BuiltInTok{DataFrames}\NormalTok{, }\BuiltInTok{CategoricalArrays}\NormalTok{, }\BuiltInTok{DataFramesMeta}

\NormalTok{df }\OperatorTok{=} \FunctionTok{DataFrame}\NormalTok{(}\FunctionTok{load}\NormalTok{(}\StringTok{"simulated\_multilevel\_data.dta"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{@transform}\NormalTok{!(df, }\OperatorTok{:}\NormalTok{country }\OperatorTok{=} \FunctionTok{categorical}\NormalTok{(}\OperatorTok{:}\NormalTok{country))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{m0 }\OperatorTok{=} \FunctionTok{fit}\NormalTok{(MixedModel, }
         \PreprocessorTok{@formula}\NormalTok{(outcome }\OperatorTok{\textasciitilde{}}\NormalTok{ (}\FloatTok{1} \OperatorTok{|}\NormalTok{ country)), df) }\CommentTok{\# unconditional model}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by maximum likelihood
 outcome ~ 1 + (1 | country)
   logLik   -2 logLik     AIC       AICc        BIC    
 -9856.1548 19712.3097 19718.3097 19718.3177 19736.3288

Variance components:
            Column   Variance Std.Dev.
country  (Intercept)   3.34871 1.82995
Residual              40.88285 6.39397
 Number of obs: 3000; levels of grouping factors: 30

  Fixed-effects parameters:
──────────────────────────────────────────────────
               Coef.  Std. Error       z  Pr(>|z|)
──────────────────────────────────────────────────
(Intercept)  53.4676    0.353908  151.08    <1e-99
──────────────────────────────────────────────────
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]

\FunctionTok{icc}\NormalTok{(m0) }\CommentTok{\# ICC}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
0.07570852291396266
\end{verbatim}

\bookmarksetup{startatroot}

\chapter{Cross Sectional Multilevel
Models}\label{cross-sectional-multilevel-models}

\section{The Equation}\label{the-equation-1}

Recall the general model of Equation~\ref{eq-MLMsimple}, and the syntax
outlined in Section~\ref{sec-syntax}. Below in
Equation~\ref{eq-MLMsubstantive}, we consider a more substantive
example.

\begin{equation}\phantomsection\label{eq-MLMsubstantive}{\text{outcome}_{ij}= \beta_0 + \beta_1 \text{warmth}_{ij} +}\end{equation}

\[\beta_2 \text{physical punishment}_{ij} +\]

\[\beta_3 \text{group}_{ij} + \beta_4 \text{HDI}_{ij} +\]

\[u_{0j} + u_{1j} \times \text{warmth}_{ij} + e_{ij}\]

\section{Correlated and Uncorrelated Random
Effects}\label{correlated-and-uncorrelated-random-effects}

Consider the covariance matrix of random effects (e.g.~\(u_{0j}\) and
\(u_{1j}\)). In Equation~\ref{eq-varcovar} the covariances of the random
effects are constrained to be zero.

\begin{equation}\phantomsection\label{eq-varcovar}{\begin{bmatrix}
var(u_{0j}) & 0 \\
0 & var(u_{1j}) 
\end{bmatrix}}\end{equation}

As discussed in Chapter 6, however, one can consider a multilevel model
in which the random effects are correlated, as is the case in
Equation~\ref{eq-varcovaruns}.

\begin{equation}\phantomsection\label{eq-varcovaruns}{\begin{bmatrix}
var(u_{0j}) & cov(u_{0j}, u_{1j}) \\
cov(u_{0j}, u_{1j}) & var(u_{1j}) 
\end{bmatrix}}\end{equation}

Procedures for estimating models with uncorrelated and correlated random
effects are detailed below (Bates et al., 2015; Bates, 2024; StataCorp,
2021).

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.1667}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3056}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3889}}@{}}
\caption{Correlated and Uncorrelated Random
Effects}\label{tbl-REs}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Software
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Uncorrelated Random Effects
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Correlated Random Effects
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Software
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Uncorrelated Random Effects
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Correlated Random Effects
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Stata & default & add option: \texttt{,\ cov(uns)} \\
R & separate random effects from grouping variable with
\texttt{\textbar{}\textbar{}} & separate random effects from grouping
variable with \texttt{\textbar{}} \\
Julia & separate terms for each random effect e.g.
\texttt{(1\ \textbar{}\ group)\ +} \texttt{(0\ +\ x\ \textbar{}\ group)}
& separate random effects from grouping variable with
\texttt{\textbar{}}. \\
\end{longtable}

All models in the examples below are run with \emph{uncorrelated} random
effects, but could just as easily be run with \emph{correlated} random
effects.

\section{Run Models}\label{run-models-1}

\subsection{Stata}

\subsubsection{Get The Data}\label{get-the-data}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{use}\NormalTok{ simulated\_multilevel\_data.dta}
\end{Highlighting}
\end{Shaded}

\subsubsection{Run The Model}\label{run-the-model}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mixed outcome warmth physical\_punishment }\FunctionTok{group}\NormalTok{ HDI || country: warmth}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood =  -9668.198  
Iteration 1:  Log likelihood = -9667.9551  
Iteration 2:  Log likelihood = -9667.9534  
Iteration 3:  Log likelihood = -9667.9533  
Iteration 4:  Log likelihood = -9667.9532  

Computing standard errors ...

Mixed-effects ML regression                          Number of obs    =  3,000
Group variable: country                              Number of groups =     30
                                                     Obs per group:
                                                                  min =    100
                                                                  avg =  100.0
                                                                  max =    100
                                                     Wald chi2(4)     = 401.26
Log likelihood = -9667.9532                          Prob > chi2      = 0.0000

-------------------------------------------------------------------------------------
            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
--------------------+----------------------------------------------------------------
             warmth |   .9616447   .0581825    16.53   0.000     .8476091     1.07568
physical_punishment |  -.8453802   .0798155   -10.59   0.000    -1.001816   -.6889448
              group |   1.084344   .2200539     4.93   0.000     .6530461    1.515642
                HDI |    .010557   .0204522     0.52   0.606    -.0295286    .0506426
              _cons |   49.87963   1.436612    34.72   0.000     47.06392    52.69534
-------------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Independent         |
                 var(warmth) |   1.83e-06   .0000173      1.76e-14    190.9774
                  var(_cons) |   3.370262   .9633726      1.924651    5.901676
-----------------------------+------------------------------------------------
               var(Residual) |   36.01906   .9346936      34.23291    37.89842
------------------------------------------------------------------------------
LR test vs. linear model: chi2(2) = 198.01                Prob > chi2 = 0.0000

Note: LR test is conservative and provided only for reference.
\end{verbatim}

\subsection{R}

\subsubsection{Get The Data}\label{get-the-data-1}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}

\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"simulated\_multilevel\_data.dta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Run The Model}\label{run-the-model-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit1 }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(outcome }\SpecialCharTok{\textasciitilde{}}\NormalTok{ warmth }\SpecialCharTok{+}\NormalTok{ physical\_punishment }\SpecialCharTok{+} 
\NormalTok{               group }\SpecialCharTok{+}\NormalTok{ HDI }\SpecialCharTok{+}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ warmth }\SpecialCharTok{||}\NormalTok{ country),}
             \AttributeTok{data =}\NormalTok{ df)}

\FunctionTok{summary}\NormalTok{(fit1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by REML ['lmerMod']
Formula: outcome ~ warmth + physical_punishment + group + HDI + ((1 |  
    country) + (0 + warmth | country))
   Data: df

REML criterion at convergence: 19350.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.4496 -0.6807  0.0016  0.6864  3.1792 

Random effects:
 Groups    Name        Variance  Std.Dev.
 country   (Intercept)  3.611568 1.90041 
 country.1 warmth       0.001876 0.04331 
 Residual              36.049124 6.00409 
Number of obs: 3000, groups:  country, 30

Fixed effects:
                    Estimate Std. Error t value
(Intercept)         49.88754    1.48203  33.662
warmth               0.96155    0.05875  16.367
physical_punishment -0.84556    0.07986 -10.588
group                1.08471    0.22017   4.927
HDI                  0.01044    0.02116   0.493

Correlation of Fixed Effects:
            (Intr) warmth physc_ group 
warmth      -0.126                     
physcl_pnsh -0.135 -0.025              
group       -0.218 -0.010 -0.019       
HDI         -0.925 -0.006  0.008 -0.001
\end{verbatim}

\subsection{Julia}

\subsubsection{Get The Data}\label{get-the-data-2}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{using} \BuiltInTok{Tables}\NormalTok{, }\BuiltInTok{MixedModels}\NormalTok{, }\BuiltInTok{StatFiles}\NormalTok{, }\BuiltInTok{DataFrames}\NormalTok{, }\BuiltInTok{CategoricalArrays}\NormalTok{, }\BuiltInTok{DataFramesMeta}

\NormalTok{df }\OperatorTok{=} \FunctionTok{DataFrame}\NormalTok{(}\FunctionTok{load}\NormalTok{(}\StringTok{"simulated\_multilevel\_data.dta"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsubsection{Change Country To
Categorical}\label{change-country-to-categorical}

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{@transform}\NormalTok{!(df, }\OperatorTok{:}\NormalTok{country }\OperatorTok{=} \FunctionTok{categorical}\NormalTok{(}\OperatorTok{:}\NormalTok{country))}
\end{Highlighting}
\end{Shaded}

\subsubsection{Run The Model}\label{run-the-model-2}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{m1 }\OperatorTok{=} \FunctionTok{fit}\NormalTok{(MixedModel, }\PreprocessorTok{@formula}\NormalTok{(outcome }\OperatorTok{\textasciitilde{}}\NormalTok{ warmth }\OperatorTok{+}\NormalTok{ physical\_punishment }\OperatorTok{+} 
\NormalTok{               group }\OperatorTok{+}\NormalTok{ HDI }\OperatorTok{+}
\NormalTok{               (}\FloatTok{1} \OperatorTok{|}\NormalTok{ country) }\OperatorTok{+}
\NormalTok{               (}\FloatTok{0} \OperatorTok{+}\NormalTok{ warmth }\OperatorTok{|}\NormalTok{ country)), df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by maximum likelihood
 outcome ~ 1 + warmth + physical_punishment + group + HDI + (1 | country) + (0 + warmth | country)
   logLik   -2 logLik     AIC       AICc        BIC    
 -9667.9532 19335.9065 19351.9065 19351.9546 19399.9574

Variance components:
            Column   Variance Std.Dev.  Corr.
country  (Intercept)   3.36982 1.83571
         warmth        0.00000 0.00000   .  
Residual              36.01912 6.00159
 Number of obs: 3000; levels of grouping factors: 30

  Fixed-effects parameters:
─────────────────────────────────────────────────────────────
                          Coef.  Std. Error       z  Pr(>|z|)
─────────────────────────────────────────────────────────────
(Intercept)          49.8796      1.43653     34.72    <1e-99
warmth                0.961645    0.058182    16.53    <1e-60
physical_punishment  -0.84538     0.0798155  -10.59    <1e-25
group                 1.08434     0.220054     4.93    <1e-06
HDI                   0.0105571   0.0204509    0.52    0.6057
─────────────────────────────────────────────────────────────
\end{verbatim}

\bookmarksetup{startatroot}

\chapter{Longitudinal Multilevel
Models}\label{longitudinal-multilevel-models}

\section{The Data}\label{the-data}

The data employed in these examples are a longitudinal extension of the
data described in Section~\ref{sec-data}.

\section{The Equation}\label{the-equation-2}

\begin{equation}\phantomsection\label{eq-MLM-longitudinal}{\text{outcome}_{itj} = \beta_0 + \beta_1 \text{parental warmth}_{itj} + \beta_2 \text{physical punishment}_{itj} + \beta_3 \text{time}_{itj} \ + }\end{equation}

\[\beta_4 \text{group}_{itj} + \beta_5 \text{HDI}_{itj} +\]

\[u_{0j} + u_{1j} \times \text{parental warmth}_{itj} \ + \]

\[v_{0i} + v_{1i} \times \text{time}_{itj} + e_{itj}\]

\section{Run Models}\label{run-models-2}

\subsection{Stata}

\subsubsection{Get The Data}\label{get-the-data-3}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{use}\NormalTok{ simulated\_multilevel\_longitudinal\_data.dta}
\end{Highlighting}
\end{Shaded}

\subsubsection{Run The Model}\label{run-the-model-3}

\paragraph{Main Effects Only}\label{main-effects-only}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mixed outcome t warmth physical\_punishment }\FunctionTok{group}\NormalTok{ HDI || country: warmth}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood =  -28795.37  
Iteration 1:  Log likelihood = -28795.232  
Iteration 2:  Log likelihood = -28795.232  

Computing standard errors ...

Mixed-effects ML regression                         Number of obs    =   9,000
Group variable: country                             Number of groups =      30
                                                    Obs per group:
                                                                 min =     300
                                                                 avg =   300.0
                                                                 max =     300
                                                    Wald chi2(5)     = 1366.93
Log likelihood = -28795.232                         Prob > chi2      =  0.0000

-------------------------------------------------------------------------------------
            outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
--------------------+----------------------------------------------------------------
                  t |   .9882371   .0761439    12.98   0.000     .8389979    1.137476
             warmth |   .9427117   .0342282    27.54   0.000     .8756256    1.009798
physical_punishment |  -.9020727   .0452759   -19.92   0.000    -.9908119   -.8133336
              group |   .9861238   .1249047     7.90   0.000     .7413151    1.230933
                HDI |   .0073726    .020661     0.36   0.721    -.0331222    .0478674
              _cons |   49.45537   1.414072    34.97   0.000     46.68384     52.2269
-------------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Independent         |
                 var(warmth) |   .0024684   .0082517      3.52e-06     1.72956
                  var(_cons) |   3.663663   .9914845      2.155548     6.22692
-----------------------------+------------------------------------------------
               var(Residual) |   34.78483   .5200702       33.7803    35.81923
------------------------------------------------------------------------------
LR test vs. linear model: chi2(2) = 805.75                Prob > chi2 = 0.0000

Note: LR test is conservative and provided only for reference.
\end{verbatim}

\paragraph{Interactions With Time}\label{interactions-with-time}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{mixed outcome c.t\#\#(c.warmth c.physical\_punishment i.}\FunctionTok{group}\NormalTok{ c.HDI) || country: warmth}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood =  -28794.99  
Iteration 1:  Log likelihood = -28794.855  
Iteration 2:  Log likelihood = -28794.855  

Computing standard errors ...

Mixed-effects ML regression                         Number of obs    =   9,000
Group variable: country                             Number of groups =      30
                                                    Obs per group:
                                                                 min =     300
                                                                 avg =   300.0
                                                                 max =     300
                                                    Wald chi2(9)     = 1365.73
Log likelihood = -28794.855                         Prob > chi2      =  0.0000

---------------------------------------------------------------------------------------
              outcome | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
----------------------+----------------------------------------------------------------
                    t |   1.047448   .3619795     2.89   0.004     .3379816    1.756915
               warmth |   .8869901   .0876058    10.12   0.000      .715286    1.058694
  physical_punishment |   -.893285   .1194705    -7.48   0.000    -1.127443    -.659127
              2.group |   .9648545   .3292217     2.93   0.003     .3195918    1.610117
                  HDI |   .0120622    .022474     0.54   0.591    -.0319861    .0561104
                      |
         c.t#c.warmth |   .0277903   .0402665     0.69   0.490    -.0511306    .1067112
                      |
                  c.t#|
c.physical_punishment |  -.0041479   .0553051    -0.08   0.940    -.1125439    .1042482
                      |
            group#c.t |
                   2  |   .0105177   .1523009     0.07   0.945    -.2879865    .3090219
                      |
            c.t#c.HDI |   -.002342   .0044172    -0.53   0.596    -.0109996    .0063155
                      |
                _cons |   50.32233   1.572089    32.01   0.000      47.2411    53.40357
---------------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Independent         |
                 var(warmth) |   .0025661   .0083259      4.44e-06    1.482773
                  var(_cons) |    3.66269    .991533      2.154617    6.226305
-----------------------------+------------------------------------------------
               var(Residual) |   34.78158   .5200283      33.77713     35.8159
------------------------------------------------------------------------------
LR test vs. linear model: chi2(2) = 805.90                Prob > chi2 = 0.0000

Note: LR test is conservative and provided only for reference.
\end{verbatim}

\subsection{R}

\subsubsection{Get The Data}\label{get-the-data-4}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}

\NormalTok{dfL }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"simulated\_multilevel\_longitudinal\_data.dta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Run The Model}\label{run-the-model-4}

\paragraph{Main Effects Only}\label{main-effects-only-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit2A }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(outcome }\SpecialCharTok{\textasciitilde{}}\NormalTok{ t }\SpecialCharTok{+}\NormalTok{ warmth }\SpecialCharTok{+}\NormalTok{ physical\_punishment }\SpecialCharTok{+} 
\NormalTok{               group }\SpecialCharTok{+}\NormalTok{ HDI }\SpecialCharTok{+}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ country}\SpecialCharTok{/}\NormalTok{id),}
             \AttributeTok{data =}\NormalTok{ dfL)}

\FunctionTok{summary}\NormalTok{(fit2A)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by REML ['lmerMod']
Formula: outcome ~ t + warmth + physical_punishment + group + HDI + (1 |  
    country/id)
   Data: dfL

REML criterion at convergence: 57088.4

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.4471 -0.6226  0.0081  0.6153  3.1993 

Random effects:
 Groups     Name        Variance Std.Dev.
 id:country (Intercept)  8.864   2.977   
 country    (Intercept)  3.924   1.981   
 Residual               26.008   5.100   
Number of obs: 9000, groups:  id:country, 3000; country, 30

Fixed effects:
                     Estimate Std. Error t value
(Intercept)         49.494782   1.471780  33.629
t                    0.987964   0.065840  15.005
warmth               0.946259   0.038200  24.771
physical_punishment -0.926880   0.049970 -18.549
group                0.985786   0.153550   6.420
HDI                  0.007543   0.021437   0.352

Correlation of Fixed Effects:
            (Intr) t      warmth physc_ group 
t           -0.090                            
warmth      -0.085  0.008                     
physcl_pnsh -0.085  0.003 -0.019              
group       -0.154  0.000 -0.013 -0.008       
HDI         -0.943  0.000 -0.003  0.003  0.000
\end{verbatim}

\paragraph{Interactions With Time}\label{interactions-with-time-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit2B }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(outcome }\SpecialCharTok{\textasciitilde{}}\NormalTok{ t }\SpecialCharTok{*}\NormalTok{(warmth }\SpecialCharTok{+}\NormalTok{ physical\_punishment }\SpecialCharTok{+} 
\NormalTok{               group }\SpecialCharTok{+}\NormalTok{ HDI) }\SpecialCharTok{+}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ country}\SpecialCharTok{/}\NormalTok{id),}
             \AttributeTok{data =}\NormalTok{ dfL)}

\FunctionTok{summary}\NormalTok{(fit2B)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by REML ['lmerMod']
Formula: outcome ~ t * (warmth + physical_punishment + group + HDI) +  
    (1 | country/id)
   Data: dfL

REML criterion at convergence: 57107.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.4431 -0.6248  0.0071  0.6183  3.1961 

Random effects:
 Groups     Name        Variance Std.Dev.
 id:country (Intercept)  8.868   2.978   
 country    (Intercept)  3.925   1.981   
 Residual               26.014   5.100   
Number of obs: 9000, groups:  id:country, 3000; country, 30

Fixed effects:
                       Estimate Std. Error t value
(Intercept)           49.453036   1.637740  30.196
t                      1.008199   0.364915   2.763
warmth                 0.865659   0.080487  10.755
physical_punishment   -0.908148   0.110449  -8.222
group                  0.966988   0.304936   3.171
HDI                    0.012277   0.022761   0.539
t:warmth               0.040170   0.035364   1.136
t:physical_punishment -0.008932   0.049262  -0.181
t:group                0.009180   0.131714   0.070
t:HDI                 -0.002359   0.003820  -0.618

Correlation of Fixed Effects:
            (Intr) t      warmth physc_ group  HDI    t:wrmt t:phy_ t:grop
t           -0.446                                                        
warmth      -0.159  0.278                                                 
physcl_pnsh -0.169  0.302 -0.022                                          
group       -0.274  0.459 -0.010 -0.014                                   
HDI         -0.900  0.227 -0.008  0.009 -0.001                            
t:warmth     0.141 -0.316 -0.880  0.017  0.010  0.007                     
t:physcl_pn  0.150 -0.338  0.017 -0.892  0.010 -0.007 -0.015              
t:group      0.237 -0.532  0.009  0.012 -0.864  0.001 -0.012 -0.008       
t:HDI        0.302 -0.676  0.018 -0.020  0.002 -0.336 -0.018  0.016 -0.002
\end{verbatim}

\subsection{Julia}

\subsubsection{Get The Data}\label{get-the-data-5}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{using} \BuiltInTok{Tables}\NormalTok{, }\BuiltInTok{MixedModels}\NormalTok{, }\BuiltInTok{StatFiles}\NormalTok{, }\BuiltInTok{DataFrames}\NormalTok{, }\BuiltInTok{CategoricalArrays}\NormalTok{, }\BuiltInTok{DataFramesMeta}

\NormalTok{dfL }\OperatorTok{=} \FunctionTok{DataFrame}\NormalTok{(}\FunctionTok{load}\NormalTok{(}\StringTok{"simulated\_multilevel\_longitudinal\_data.dta"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsubsection{Run The Model}\label{run-the-model-5}

\paragraph{Change Country To
Categorical}\label{change-country-to-categorical-1}

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{@transform}\NormalTok{!(dfL, }\OperatorTok{:}\NormalTok{country }\OperatorTok{=} \FunctionTok{categorical}\NormalTok{(}\OperatorTok{:}\NormalTok{country))}
\end{Highlighting}
\end{Shaded}

\paragraph{Main Effects Only}\label{main-effects-only-2}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{m2A }\OperatorTok{=} \FunctionTok{fit}\NormalTok{(MixedModel, }\PreprocessorTok{@formula}\NormalTok{(outcome }\OperatorTok{\textasciitilde{}}\NormalTok{ t }\OperatorTok{+}\NormalTok{ warmth }\OperatorTok{+} 
\NormalTok{                                 physical\_punishment }\OperatorTok{+} 
\NormalTok{                                 group }\OperatorTok{+}\NormalTok{ HDI }\OperatorTok{+}
\NormalTok{                                 (}\FloatTok{1} \OperatorTok{|}\NormalTok{ country) }\OperatorTok{+} 
\NormalTok{                                 (}\FloatTok{0} \OperatorTok{+}\NormalTok{ warmth }\OperatorTok{|}\NormalTok{ country) }\OperatorTok{+}
\NormalTok{                                 (}\FloatTok{1} \OperatorTok{|}\NormalTok{ id)), dfL)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by maximum likelihood
 outcome ~ 1 + t + warmth + physical_punishment + group + HDI + (1 | country) + (0 + warmth | country) + (1 | id)
    logLik   -2 logLik      AIC         AICc        BIC     
 -28533.9968  57067.9935  57087.9935  57088.0180  57159.0433

Variance components:
            Column   Variance Std.Dev.  Corr.
id       (Intercept)   8.85263 2.97534
country  (Intercept)   3.65031 1.91058
         warmth        0.00000 0.00000   .  
Residual              26.00093 5.09911
 Number of obs: 9000; levels of grouping factors: 3000, 30

  Fixed-effects parameters:
──────────────────────────────────────────────────────────────
                           Coef.  Std. Error       z  Pr(>|z|)
──────────────────────────────────────────────────────────────
(Intercept)          49.4945       1.42422     34.75    <1e-99
t                     0.987965     0.0658315   15.01    <1e-50
warmth                0.946255     0.0381869   24.78    <1e-99
physical_punishment  -0.926774     0.0499549  -18.55    <1e-76
group                 0.985819     0.153487     6.42    <1e-09
HDI                   0.00754357   0.0207101    0.36    0.7157
──────────────────────────────────────────────────────────────
\end{verbatim}

\paragraph{Interactions With Time}\label{interactions-with-time-2}

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{m2B }\OperatorTok{=} \FunctionTok{fit}\NormalTok{(MixedModel, }\PreprocessorTok{@formula}\NormalTok{(outcome }\OperatorTok{\textasciitilde{}}\NormalTok{ t }\OperatorTok{*}\NormalTok{ (warmth }\OperatorTok{+} 
\NormalTok{                                 physical\_punishment }\OperatorTok{+} 
\NormalTok{                                 group }\OperatorTok{+}\NormalTok{ HDI) }\OperatorTok{+}
\NormalTok{                                 (}\FloatTok{1} \OperatorTok{|}\NormalTok{ country) }\OperatorTok{+}
\NormalTok{                                 (}\FloatTok{0} \OperatorTok{+}\NormalTok{ warmth }\OperatorTok{|}\NormalTok{ country) }\OperatorTok{+}
\NormalTok{                                 (}\FloatTok{1} \OperatorTok{|}\NormalTok{ id)), dfL)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Linear mixed model fit by maximum likelihood
 outcome ~ 1 + t + warmth + physical_punishment + group + HDI + t & warmth + t & physical_punishment + t & group + t & HDI + (1 | country) + (0 + warmth | country) + (1 | id)
    logLik   -2 logLik      AIC         AICc        BIC     
 -28533.1579  57066.3158  57094.3158  57094.3626  57193.7855

Variance components:
            Column   Variance Std.Dev.  Corr.
id       (Intercept)   8.86088 2.97672
country  (Intercept)   3.65109 1.91078
         warmth        0.00000 0.00000   .  
Residual              25.99020 5.09806
 Number of obs: 9000; levels of grouping factors: 3000, 30

  Fixed-effects parameters:
─────────────────────────────────────────────────────────────────
                               Coef.  Std. Error      z  Pr(>|z|)
─────────────────────────────────────────────────────────────────
(Intercept)              49.4526      1.59495     31.01    <1e-99
t                         1.00828     0.364747     2.76    0.0057
warmth                    0.865674    0.0804504   10.76    <1e-26
physical_punishment      -0.908024    0.110399    -8.22    <1e-15
group                     0.967016    0.304798     3.17    0.0015
HDI                       0.0122774   0.0220761    0.56    0.5781
t & warmth                0.0401613   0.0353475    1.14    0.2559
t & physical_punishment  -0.00895284  0.0492392   -0.18    0.8557
t & group                 0.00918249  0.131654     0.07    0.9444
t & HDI                  -0.00235908  0.00381845  -0.62    0.5367
─────────────────────────────────────────────────────────────────
\end{verbatim}

\bookmarksetup{startatroot}

\chapter*{References}\label{references}
\addcontentsline{toc}{chapter}{References}

\markboth{References}{References}

\phantomsection\label{refs}
\begin{CSLReferences}{1}{0}
\bibitem[\citeproctext]{ref-MixedModels}
Bates, D. (2024). \emph{{MixedModels.jl Documentation}}.
\url{https://juliastats.org/MixedModels.jl/stable/}

\bibitem[\citeproctext]{ref-JSSv067i01}
Bates, D., Mächler, M., Bolker, B., \& Walker, S. (2015). Fitting linear
mixed-effects models using lme4. \emph{Journal of Statistical Software},
\emph{67}(1), 1--48. \url{https://doi.org/10.18637/jss.v067.i01}

\bibitem[\citeproctext]{ref-JuliaArticle}
Bezanson, J., Edelman, A., Karpinski, S., \& Shah, V. B. (2017). Julia:
A fresh approach to numerical computing. \emph{SIAM Review},
\emph{59}(1), 65--98. \url{https://doi.org/10.1137/141000671}

\bibitem[\citeproctext]{ref-RProgram}
R Core Team. (2023). \emph{R: A language and environment for statistical
computing}. R Foundation for Statistical Computing.
\url{https://www.R-project.org/}

\bibitem[\citeproctext]{ref-Schanen2021}
Schanen, J. (2021). \emph{Math person ({Strogatz Prize} entry)}.
National Museum of Mathematics.

\bibitem[\citeproctext]{ref-StataCorp2021:2}
StataCorp. (2021). \emph{Stata 17 multilevel mixed effects reference
manual}. Stata Press.

\bibitem[\citeproctext]{ref-Thoreau1975}
Thoreau, H. D. (1975). The commercial spirit of modern times. In J. J.
Moldenhauer, E. Moser, \& A. C. Kern (Eds.), \emph{Early essays and
miscellanies}. Princeton University Press.

\end{CSLReferences}



\end{document}
